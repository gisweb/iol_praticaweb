<plominodatabase id="iol_praticaweb">
  <design>
    <resource id="associaPratica" title="" type="Script (Python)"><![CDATA[## Script (Python) "associaPratica"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=protocollo='0',anno='2000',pratica='',progettista=''
##title=
##
from Products.CMFPlomino.PlominoUtils import DateToString,StringToDate, json_dumps
db=context.getParentDatabase()
index=db.getIndex()

#data_protocollo=StringToDate(data,format="%d/%m/%Y")
numero_protocollo_testo='Anno %s n. % 6d' %(anno,int(protocollo))
#numero_protocollo_testo='Anno 2019 n. 746'

#query = {"numero_protocollo":nprotocollo,"data_protocollo":{"query":[datamin,datamax],"range":"min:max"}}    
query = {"numero_protocollo_testo":numero_protocollo_testo,"numero_pratica":pratica,"ProgettistaCF":progettista}                          

brains = index.dbsearch(query,only_allowed=False)

if len(brains)>0:
    return json_dumps({"success":1, "id":brains[0].id, "numero":brains[0].numero_pratica})
else:
    return json_dumps({"success":0})
]]></resource>
  </design>
</plominodatabase>
